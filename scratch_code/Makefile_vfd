#Your HDF5 install path

# HDF5_DIR=$(HOME)/.conda/pkgs/hdf5-1.14.0-nompi_h5231ba7_103
# HDF5_DIR=$(HOME)/.conda/pkgs/hdf5-1.14.0-nompi_hb72d44e_103
# HDF5_DIR=$(HOME)/miniconda3/envs/flextrkr
# HDF5_DIR=$(HOME)/.conda/envs/pyflextrkr_copy

# -DH5_HAVE_THREADSAFE -DH5_HAVE_PTHREAD_H
# -DH5_HAVE_FLOCK -DH5_HAVE_SYS_FILE_H
# -DH5_HAVE_THREADSAFE -DH5_HAVE_PTHREAD_H
# h5c++ h5hlc++ gcc mpicc h5cc h5hlcc

HDF5_DIR=$(HOME)/install/hdf5
CC=h5c++ 
POSIX_FLAGS=-DH5_HAVE_SYS_TIME_H -DH5_HAVE_UNISTD_H \
			-DH5_HAVE_PWD_H -DH5_HAVE_WAITPID \
			-DH5_HAVE_SYS_STAT_H -DH5_HAVE_SYS_RESOURCE_H \
			-DH5_HAVE_SYS_IOCTL_H -DH5_HAVE_DLFCN_H \
			-DH5_HAVE_FLOCK -DH5_HAVE_SYS_FILE_H \
			-DH5_HAVE_PREADWRITE


DEBUG=-g -O0 -DDEBUG -gdwarf-4 -gdwarf-3 -gdwarf-2
INCLUDES=-I$(HDF5_DIR)/include 

CFLAGS = $(DEBUG) -fPIC $(INCLUDES) -w -Wall $(POSIX_FLAGS)

LIBS=-L$(HDF5_DIR)/lib -lhdf5 -lz
DYNLDFLAGS = -shared -fPIC $(LIBS)
LDFLAGS = $(DEBUG) $(LIBS)

# Shared library VOL connector
DYNSRC = H5FD_tracker_vfd.cc
DYNOBJ = $(DYNSRC:.c=.o)
DYNLIB = libhdf5_tracker_vfd.so


all: $(DYNLIB)

$(DYNLIB): $(DYNSRC)
	$(CC) $(CFLAGS) $(DYNLDFLAGS) $^ -o $@

.PHONY: clean all
clean:
	rm -rf $(DYNOBJ) $(DYNLIB) \
            $(EXOBJ) $(EXEXE) $(EXDBG)
